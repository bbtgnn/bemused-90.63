// VARIABLES

var links =  [
	"http://www.resort.com/~banshee/Misc/8ball/",
	"https://www.scaruffi.com/",
	"http://travelassist.com/mag/mag_home.html",
	"http://www.taco.com/",
	"http://edition.cnn.com/US/OJ/",
	"https://spork.org/",
	"http://www.milamba.com/australia/",
	"http://www.geocities.ws/dreddnott/default.html",
	"http://www.arngren.net/",
	"http://toastytech.com/evil/"
];

var texts =  [
	"In some profound way, cyberspace is another space. Unleashed into the internet, my \“location\” can no longer be fixed purely in physical space.",
	"But cyberspace has become much more than just a space, because as we have noted much of what goes on there is information-oriented. As many commentators have stressed, primary use of cyberspace is not for information-gathering but social interaction and communication-and increasingly a l d interactive entertainment, including the creation of a buring number of online fantasy worlds in which people take o orate alter egos",
	"Not to find one’s way in a city may well be uninteresting and banal. It requires ignorance—nothing more,\” says the twentieth-century philosopher-essayist Walter Benjamin. \“But to lose oneself in a city—as one loses oneself in a forest—that calls for quite a different schooling.\” To lose yourself: a voluptuous surrender, lost in your arms, lost to the world, utterly immersed in what is present so that its surroundings fade away. In Benjamin’s terms, to be lost is to be fully present, and to be fully present is to be capable of being in uncertainty and mystery. And one does not get lost but loses oneself, with the implication that it is a conscious choice, a chosen surrender, a psychic state achievable through geography.",
	"That thing the nature of which is totally unknown to you is usually what you need to find, and finding it is a matter of getting lost. The word \“lost\” comes from the Old Norse los, meaning the disbanding of an army, and this origin suggests soldiers falling out of formation to go home, a truce with the wide world. I worry now that many people never disband their armies, never go beyond what they know.",
	"Search-and-rescue teams have made an art of finding and a science of how people get lost, though as many or more of their forays are rescues for people who are injured or stranded. The simplest answer nowadays for literal getting lost is that a lot of the people who get lost aren’t paying attention when they do so, don’t know what to do when they realize they don’t know how to return, or don’t admit they don’t know.",
	"The question then is how to get lost. Never to get lost is not to live, not to know how to get lost brings you to destruction, and somewhere in the terra incognita in between lies a life of discovery.",
	"De Angulo goes on to say that wandering can lead to death, to hopelessness, to madness, to various froms of despair, or that it may lead to encounters with other powers in the remoter places a wanderer may go. He concludes, \“When you have become quite wild, then perhaps some of the wild things will come to take a look at you, and one of them may perhaps take a fancy to you, not because you are suffering and cold, but simply because he happens to like your looks. When this happens, the wandering is over, and the Indian becomes a shaman.\"",
	"What is a ruin, after all? It is a human construction abandoned to nature, and one of the allures of ruins in the city is that of wilderness: a place full of the promise of the unknown with all its epiphanies and dangers. Cities are built by men (and to a lesser extent, women), but they decay by nature, from earthquakes and hurricanes to the incremental processes of rot, erosion, rust, the microbial breakdown of concrete, stone, wood, and brick, the return of plants and animals making their own complex order that further dismantles the simple order of men. This nature is allowed to take over when, for economic or political reasons, maintenance is withdrawn. Ruins are also created by the vandalism, arson, and war in which humans run wild. Cities in Europe and the American South have been consciously ruined by war, but this country’s North and West have fallen into ruin only for other reasons. Ruins were the symbolic home of much of the art of the time, some photography and painting, much music, the science fiction movies of the time, even the backdrops for rock videos and fashion photographs, for clothes that looked ancient, worn, combat[…]",
	"We are now at the beginning of an era whose constructions are far scarier than ruins. In the time of which I write, the new silicon-based life forms were sneaking into every interstice without setting off alarms that all would be utterly changed in a way far more insidious than nuclear war, that they would bring a new wealth that would erase the ruins.",
	"We are the hackers of abstraction. We produce new concepts, new perceptions, new sensations, hacked out of raw data. Whatever code we hack, be it programming language, poetic language, math or music, curves or colorings, we are the abstracters of new worlds. Whether we come to represent ourselves as researchers or authors, art- ists or biologists, chemists or musicians, philosophers or programmers, each of these subjectivities is but a fragment of a class still becoming, bit by bit, aware of itself as such.",
	"Hackers create the possibility of new things entering the world. Not always great things, or even good things, but new things. In art, in science, in philosophy and culture, in any production of knowledge where data can be gathered, where information can be extracted from it, and where in that information new possibilities for the world produced, there are hackers hacking the new out of the old. While we create these new worlds, we do not possess them. That which we create is mortgaged to others, and to the interests of others, to states and corporations who monopolize the means for making worlds we alone discover. We do not own what we produce—it owns us.",
	"What the times call for is a collective hack that realizes a class interest based on an alignment of differences rather than a coercive unity.",
	"What makes our times different is the appearance on the horizon of possibility of a new world, long imagined—a world free from necessity. The production of abstraction has reached the threshold where it can break the shackles hold- ing hacking fast to outdated and regressive class interests, once and for all. Debord: \"The world already possesses the dream of a time whose consciousness it must now possess in order to actually live it.\"",
	"The representation of history dominant in any era is the product of the educational apparatus established by its rul- ing powers. Even dissenting history takes form within insti- tutions not of its making. While not all history represents the interests of the ruling classes, the institution of history exists as something other than what it can become when free of class constraint, namely, the abstract guide to trans- formation of the ruling order in the interests of the producing classes, whose collective action expresses the events his- tory merely represents.",
	"A hacker history challenges not just the content of history, but its form. Adding yet more representations to the heap of history’s goods, even representations of the oppressed and excluded, does nothing if it does not challenge the separa- tion of history as representation from the great productive forces that make history in the first place. The educational apparatus of the overdeveloped world would make even the unscripted voice of the subaltern peasant part of its property, but the productive classes have need only of the speech of their own productivity to recover the productivity of speech.",
	"Information wants to be free but is everywhere in chains.",
	"Information may want to be free, but it is not possible to know the limits or potentials of its freedom when the virtual is subordinated to this actual state of ownership and scarcity. Privatizing information and knowledge as commodified \“content\” distorts and deforms its free development, and prevents the very concept of its freedom from its own free development. \“As our economy becomes increasingly dependent on information, our traditional system of property rights applied to information becomes a costly fetter on our development.\”* The subordination of hackers to the vectoralist interest means the enslavement not only of the whole of human potential but also natural potential. While information is chained to the interests of its owners, it is not just hackers who may not know their interests, no class may know what it may become.",
	"Property is theft!” as Proudhon says.* It is theft abstracted, the theft of nature from itself, by collective social labor, constrained within the property form. Property is not naturally occurring. It is not a natural right but a historical product, product of a powerful hack of ambivalent consequences. To make something property is to separate it from a continuum, to mark it or bound it, to represent it as something finite. At the same time, making something as property connects it, via a representation of it as a separate and finite object, to the subject who owns it. What is cut from one pro-cess joins another process, what was nature becomes second nature.",
	"All representation is false. A likeness differs of necessity from what it represents. If it did not, it would be what it represents, and thus not a representation. The only truly false representation is the belief in the possibility of true representation.",
	"Can the digital future be our home?",
	"surveillance capitalists discovered that the most-predictive behavioral data come from intervening in the state of play in order to nudge, coax, tune, and herd behavior toward profitable outcomes. Competitive pressures produced this shift, in which automated machine processes not only know our behavior but also shape our behavior at scale. With this reorientation from knowledge to power, it is no longer enough to automate information flows about us; the goal now is to automate us.",
	"Instrumentarian power knows and shapes human behavior toward others’ ends. Instead of armaments and armies, it works its will through the automated medium of an increasingly ubiquitous computational architecture of “smart” networked devices, things, and spaces.",
	"Surveillance capitalism runs contrary to the early digital dream, consigning the Aware Home to ancient history. Instead, it strips away the illusion that the networked form has some kind of indigenous moral content, that being “connected” is somehow intrinsically pro-social, innately inclusive, or naturally tending toward the democratization of knowledge. Digital connection is now a means to others’ commercial ends. At its core, surveillance capitalism is parasitic and self-referential.",
	"Surveillance capitalism is no longer confined to the competitive dramas of the large internet companies, where behavioral futures markets were first aimed at online advertising. Its mechanisms and economic imperatives have become the default model for most internet-based businesses. Eventually, competitive pressure drove expansion into the offline world, where the same foundational mechanisms that expropriate your online browsing, likes, and clicks are trained on your run in the park, breakfast conversation, or hunt for a parking space.",
	"An unprecedented formulation of capitalism was elbowing its way into history: surveillance capitalism. This new market form is a unique logic of accumulation in which surveillance is a foundational mechanism in the transformation of investment into profit. Its rapid rise, institutional elaboration, and significant expansion challenged the tentative promise of the inversion and its advocacy-oriented values. More generally, the rise of surveillance capitalism betrayed the hopes and expectations of many “netizens” who cherished the emancipatory promise of the networked milieu.",
	"This, I should say, is the essential myth of modern life: that the city has become a free field of signs and exhibits, a marketable mass of images, an area in which the old separations have broken down for good. The modern, to repeat the myth once more, is the marginal; it is ambiguity, it is mixture of classes and classifications, it is anomie and improvisation, it is the reign of generalized illusion.",
	"The colonization of everyday life proceeds apace, an “invasion and sterilizing of so many unoccupied areas of human species-being.” What is somewhat blandly referred to as globalization turns in on itself, “mapping and enclosing the hinterland of the social.",
	"It was an identical mood that guided our wanderings through the streets, the lanes and the alleys, through the meanderings of a pleasure that our every step helped us gauge in terms of what it might take to expand and refine it just a little further…",
	"Orienting action is like turning the rudder of a boat in a swift and uncertain current. It is not an act of domination, of imposing a will on time. It is an act which works both with and against the current of the times, ornamenting it.",
	"what is the aim of utopian investigation? The conquest of everyday life, the recreation of the everyday and the recuperation of the forces which have been alienated in aesthetics, scattered through politics, lost in abstraction, severed from what is possible and what is real.",
	"Contemplare rovine non equivale a fare un viaggio nella storia, ma a fare un’esperienza del tempo, del tempo puro. Riguardo al passato, la storia è troppo ricca, troppo molteplice e troppo profonda per ridursi al segno di pietra che ne è emerso, oggetto perduto come quelli ritrovati dagli archeologi che scavano le loro fette di spazio-tempo. Riguardo al presente, l’emozione è di ordine estetico, ma lo spettacolo della natura vi si combina con quello delle vestigia",
	"Le rovine esistono attraverso lo sguardo che si posa su di esse. Ma fra i loro molteplici passati e la loro perduta funzionalità, quel che di esse si lascia percepire è una sorta di tempo al di fuori della storia a cui l’individuo che la contempla è sensibile come se lo aiutasse a comprendere la durata che scorre in lui",
	"he classic labyrinth of Cnossos is unicursal: there is only one path. Once one enters one cannot help reaching the center (and from the center one cannot help finding the way out). If the unicursal labyrinth were to be “unrolled,” we would find we had a single thread in our hands— the thread of Ariadne which the legend presents as the means (alien to the labyrinth) of extricating oneself from the labyrinth, whereas in fact all it is is the labyrinth itself",
	"The second type is the Mannerist labyrinth or Irrweg. The Irrweg proposes alternative choices, but all the paths lead to a dead point— all but one, that is, which leads to the way out. If it were “unrolled,” the Irrweg would assume the form of a tree, of a structure of blind alleys (except for one).  One can take the wrong path, in which case one is obliged to retrace one’s steps (in a certain sense the Irrweg works like a flowchart)",
	"The third kind of labyrinth is a network, in which every point may be connected with any other point  A network cannot be “unrolled.” One reason for this is because, whereas the first two kinds of labyrinth have an inside and an outside, from which one enters and toward which one exits, the third kind of labyrinth, infinitely extendible, has no inside and no outside. Since every one of its points can be connected with any other, and since the process of connection is also a continual process of correction of the connections, its structure will always be different from what it was a moment ago, and it can be traversed by taking a different route each time. Those who travel in it, then, must also learn to correct constantly the image they have of it, whether this be a concrete (local) image of one of its sections, or the hypothetical regulatory image concerning its global structure",
	"A network is a tree plus an infinite number of corridors that connect its nodes. The tree may become (multidimensionally) a polygon, a system of interconnected polygons, an immense megahedron",
];



// FUNCTIONS

function getLocation(href) {
    var l = document.createElement("a");
    l.href = href;
    return l;
};



// INSTRUCTIONS

chrome.extension.sendMessage({}, function(response) {
	var readyStateCheckInterval = setInterval(function() {
		
	if (document.readyState === "complete") {
		clearInterval(readyStateCheckInterval);

		// Creating list of links hostnames for IF condition
		var linksHostnames = [];
		for (var i = 0; i < links.length; i++){
			linksHostnames.push(getLocation(links[i]).hostname);
		}

		// Selecting all links and changing them to random link from list
		var allLinks = document.querySelectorAll("a"); //
		for (var i = 0; i < allLinks.length; i++){
			var randomIndex = Math.floor( Math.random() * (links.length));
			allLinks[i].setAttribute('href', links[randomIndex]);
			allLinks[i].setAttribute('target', '_self');
		}

		// Getting current website
		var currentLocation = window.location;

		// If we're in a webpage from the list, add div
		if (linksHostnames.includes(currentLocation.hostname)){

			// Inverts color according to injected css
			document.querySelector("html").classList.add("inversed");

			// Getting index
			idx_promise = new Promise(function(resolve, reject) {
				chrome.storage.local.get('idx', function(result) {
					resolve(result);
				});
			});

			// Once you get the index, draw the div
			idx_promise.then(function(idx_promise) {

				console.log(idx_promise.idx);

				// Creating div
				
				var div = document.createElement("div");
				div.classList.add("rectangle");
				document.querySelector("body").appendChild(div);

				var span = document.createElement("span");
				span.classList.add("rectangletext")
				span.innerHTML = texts[idx_promise.idx];
				div.appendChild(span);

				var div_wdt = div.offsetWidth;
				var div_hgt = div.offsetHeight;

				var div_x = Math.round((window.innerWidth  - div_wdt) * Math.random());
				var div_y = Math.round((window.innerHeight - div_hgt) * Math.random());
				div.style.left = div_x + "px";
				div.style.top  = div_y + "px";
				//div.style.width  = div_wdt + "px";
				//div.style.height = div_hgt + "px";
			});

			// Updating index
			chrome.storage.local.get("idx", function(result) {
				var new_idx = (result.idx+1) % texts.length;
				chrome.storage.local.set({"idx": new_idx}, function(){
					// null
				})
			});
		}
	}
	}, 10);
});